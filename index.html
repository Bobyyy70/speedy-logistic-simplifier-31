
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speed E Log - Logistique E-commerce Simplifi√©e pour PME</title>
    <meta name="description" content="Externalisez votre logistique e-commerce avec Speed E Log. Services fiables et transparents pour PME." />
    <meta name="author" content="Speed E Log" />

    <meta property="og:title" content="Speed E Log - Logistique E-commerce Simplifi√©e pour PME" />
    <meta property="og:description" content="Externalisez votre logistique e-commerce avec Speed E Log. Services fiables et transparents pour PME." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://speedelog.fr/opengraph-image.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@speedelog" />
    <meta name="twitter:image" content="https://speedelog.fr/opengraph-image.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Start of HubSpot Embed Code -->
    <script type="text/javascript" id="hs-script-loader" async defer src="//js-eu1.hs-scripts.com/144571109.js"></script>
    <!-- End of HubSpot Embed Code -->

    <!-- Enhanced HubSpot Debug Script avec d√©tection d'environnement -->
    <script>
      console.log('üöÄ D√©marrage du monitoring HubSpot avanc√©...');
      
      // D√©tection de l'environnement
      const isInIframe = window !== window.top;
      const isLovablePreview = window.location.hostname.includes('lovable');
      const isProduction = !isLovablePreview && !window.location.hostname.includes('localhost');
      
      console.log('üåç Environnement d√©tect√©:', {
        iframe: isInIframe,
        lovablePreview: isLovablePreview,
        production: isProduction,
        hostname: window.location.hostname,
        protocol: window.location.protocol
      });
      
      // Variables de suivi
      let hubspotCheckInterval;
      let hubspotLoadTime = Date.now();
      
      // Fonction de diagnostic compl√®te
      const runHubSpotDiagnostic = () => {
        const now = Date.now();
        const elapsed = (now - hubspotLoadTime) / 1000;
        
        console.group(`üîç Diagnostic HubSpot (${elapsed.toFixed(1)}s)`);
        
        // V√©rification des objets globaux
        console.log('üìä Objets globaux:', {
          '_hsp exists': !!window._hsp,
          '_hsp array length': window._hsp ? window._hsp.length : 'N/A',
          'hbspt exists': !!window.hbspt,
          'hbspt.privacy exists': !!(window.hbspt && window.hbspt.privacy),
          'hbspt.forms exists': !!(window.hbspt && window.hbspt.forms)
        });
        
        // V√©rification de l'environnement
        console.log('üåê Contexte:', {
          iframe: isInIframe,
          lovable: isLovablePreview,
          production: isProduction,
          cookiesEnabled: navigator.cookieEnabled,
          thirdPartyCookies: !isInIframe || isProduction
        });
        
        // V√©rification des cookies
        const cookies = document.cookie.split(';').reduce((acc, cookie) => {
          const [key, value] = cookie.trim().split('=');
          if (key && key.includes('hs')) acc[key] = value;
          return acc;
        }, {});
        
        console.log('üç™ Cookies HubSpot:', cookies);
        
        // V√©rification du script
        const hsScript = document.getElementById('hs-script-loader');
        console.log('üìú Script HubSpot:', {
          'script exists': !!hsScript,
          'script src': hsScript ? hsScript.src : 'N/A',
          'script loaded': hsScript ? !hsScript.hasAttribute('async') || hsScript.readyState === 'complete' : false
        });
        
        // Recommandations selon l'environnement
        if (isInIframe) {
          console.log('‚ö†Ô∏è Recommandation: Banni√®re HubSpot limit√©e en iframe, utiliser la banni√®re alternative');
        }
        if (isLovablePreview) {
          console.log('‚ÑπÔ∏è Note: Test en environnement Lovable, d√©ployer en production pour test complet');
        }
        
        console.groupEnd();
      };
      
      // Monitoring p√©riodique avec logique adapt√©e √† l'environnement
      hubspotCheckInterval = setInterval(() => {
        if (window._hsp || (window.hbspt && window.hbspt.privacy)) {
          console.log('‚úÖ HubSpot d√©tect√©! Arr√™t du monitoring.');
          clearInterval(hubspotCheckInterval);
          runHubSpotDiagnostic();
          
          // D√©clencher l'√©v√©nement custom
          window.dispatchEvent(new CustomEvent('hsLoaded', { 
            detail: { 
              timestamp: Date.now(),
              environment: {
                iframe: isInIframe,
                lovable: isLovablePreview,
                production: isProduction
              }
            } 
          }));
          
          // Essayer d'afficher la banni√®re automatiquement si en production
          if (isProduction && !isInIframe && !document.cookie.includes('__hs_cookie_cat_pref')) {
            setTimeout(() => {
              if (window._hsp) {
                console.log('üéØ Affichage automatique de la banni√®re HubSpot...');
                window._hsp.push(['showBanner']);
              }
            }, 1000);
          }
          
        } else {
          const elapsed = (Date.now() - hubspotLoadTime) / 1000;
          if (elapsed > 10) {
            console.log(`‚è≥ Attente de HubSpot... (${elapsed.toFixed(1)}s)`);
          }
        }
      }, 2000);
      
      // Diagnostic initial apr√®s le chargement de la page
      window.addEventListener('load', () => {
        console.log('üìÑ Page charg√©e, diagnostic initial...');
        setTimeout(runHubSpotDiagnostic, 1000);
      });
      
      // √âcouter les erreurs de script
      window.addEventListener('error', (event) => {
        if (event.filename && event.filename.includes('hs-scripts')) {
          console.error('üí• Erreur de chargement du script HubSpot:', event);
        }
      });
      
      // Fonction globale pour tests manuels am√©lior√©e
      window.testHubSpot = () => {
        console.log('üß™ Test manuel HubSpot...');
        runHubSpotDiagnostic();
        
        if (isInIframe) {
          console.log('‚ö†Ô∏è Test en iframe - banni√®re HubSpot peut √™tre bloqu√©e');
          console.log('üí° Suggestion: Utiliser la banni√®re alternative disponible');
        }
        
        if (window._hsp) {
          console.log('üéØ Test showBanner via _hsp...');
          window._hsp.push(['showBanner']);
        }
        
        if (window.hbspt && window.hbspt.privacy && window.hbspt.privacy.showBanner) {
          console.log('üéØ Test showBanner via hbspt.privacy...');
          window.hbspt.privacy.showBanner();
        }
        
        // Test de tracking
        if (window._hsp) {
          console.log('üìä Test trackPageView...');
          window._hsp.push(['trackPageView']);
        }
      };
      
      // Timeout de s√©curit√© pour √©viter le monitoring infini
      setTimeout(() => {
        if (hubspotCheckInterval) {
          clearInterval(hubspotCheckInterval);
          console.log('‚è∞ Arr√™t du monitoring apr√®s 30s');
          if (!window._hsp && !window.hbspt) {
            console.warn('‚ö†Ô∏è HubSpot non d√©tect√© apr√®s 30s - v√©rifier la configuration');
          }
        }
      }, 30000);
      
      console.log('üí° Commandes disponibles:');
      console.log('- testHubSpot() : Test manuel complet');
      console.log('- window._hsp : Array des commandes HubSpot');
      if (isInIframe) {
        console.log('üñºÔ∏è Mode iframe d√©tect√© - banni√®re alternative recommand√©e');
      }
    </script>
  </body>
</html>
